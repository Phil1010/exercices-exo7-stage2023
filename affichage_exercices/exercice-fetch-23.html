<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Page fetch 23</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Librairie mathjax -->
    <script src="https://polyfill.io/v3/polyfill.js?features=es6"></script>

    <!-- Configuration de MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>

    <!-- Librairie mathjax -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3.0.4/es5/tex-mml-chtml.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>    
  </head>

  <body>
    <div class="container-fluid">
      <h1 id="numExercice"></h1>
      <h3 id="auteur"><h3>
      <h4 id="date"></h4>
      <br>
      <br>
      <h4>Enoncé : </h4>
      <p id="enonce"></p>
      <br>
      <h4>Indications : </h4>
      <p id="indications"></p>
      <br>
      <h4>Correction : </h4>
      <p id="correction"></p> 
            
    </div>
      
    </div>
    <script>
      
      
      // Remplace tous les  \'[lettre]  par la lettre avec accent
      function replaceAccents(chaine) {
        const accents = [String.raw`\\'e`, String.raw`\\\`e`, String.raw`\\\^e`, String.raw`\\"e`,
                        String.raw`\\\`a`, String.raw`\\\^a`, String.raw`\\\^i`, String.raw`\\"i`,
                        String.raw`\\\^o`, String.raw`\\"o`, String.raw`\\\^u`, String.raw`\\"u`];

          // Flag 'g' pour remplacer toutes les occurrences.
          const exp_reg0 = new RegExp(accents[0], 'g');
          chaine = chaine.replace(exp_reg0, "é");
          const exp_reg1 = new RegExp(accents[1], 'g');
          chaine = chaine.replace(exp_reg1, "è");
          const exp_reg2 = new RegExp(accents[2], 'g');
          chaine = chaine.replace(exp_reg2, "ê");
          const exp_reg3 = new RegExp(accents[3], 'g');
          chaine = chaine.replace(exp_reg3, "ë");
          const exp_reg4 = new RegExp(accents[4], 'g');
          chaine = chaine.replace(exp_reg4, "à");
          const exp_reg5 = new RegExp(accents[5], 'g');
          chaine = chaine.replace(exp_reg5, "â");
          const exp_reg6 = new RegExp(accents[6], 'g');
          chaine = chaine.replace(exp_reg6, "î");
          const exp_reg7 = new RegExp(accents[7], 'g');
          chaine = chaine.replace(exp_reg7, "ï");
          const exp_reg8 = new RegExp(accents[8], 'g');
          chaine = chaine.replace(exp_reg8, "ô");
          const exp_reg9 = new RegExp(accents[9], 'g');
          chaine = chaine.replace(exp_reg9, "ö");
          const exp_reg10 = new RegExp(accents[10], 'g');
          chaine = chaine.replace(exp_reg10, "û");
          const exp_reg11 = new RegExp(accents[11], 'g');
          chaine = chaine.replace(exp_reg11, "ü");
          return chaine;
      } 

    let exo23 = 'https://raw.githubusercontent.com/exo7math/exercices-exo7/master/exercices/ex000023.txt';


fetch(exo23)
  .then(response => response.text())
  .then(fetchedText => {
    
    // code source latex
    let exercice = document.createElement('div');
    exercice.textContent = fetchedText;

    // Mots clés devant figurant dans chaque exercice 
    var motsObligatoires = [String.raw`\exercice`, String.raw`\finexercice`, String.raw`\enonce`,String.raw`\finenonce`];
    // Vérifie si ces mots sont présents dans le texte de l'exercice
    let latexValide = motsObligatoires.every(item => fetchedText.includes(item));
    
    if (!latexValide){ // Si non présents, exercice incorrect
      document.write("<h2> Le code latex de l'exercice contient une erreur </h2>");
      throw new Error("Code latex incorrect");} // Arrêt du script
    
  //Si l'exercice est correctement écrit :
    // Gestion de bug avec le tag LaTeX : \begin{enumerate}
    var beginEnumerate = fetchedText.indexOf(String.raw`\begin{enumerate}`);
    // Suppression du tag s'il est présent dans l'exercice
    if (beginEnumerate != -1){ 
      fetchedText = fetchedText.replaceAll(String.raw`\begin{enumerate}`, '');
      fetchedText = fetchedText.replaceAll(String.raw`\item`, '');
      fetchedText = fetchedText.replaceAll(String.raw`\end{enumerate}`, '');
    }

    // initialisation des variables
    let numExercice = document.getElementById("numExercice");
    let auteur = document.getElementById("auteur");
    let date = document.getElementById("date");
    let enonce = document.getElementById("enonce");
    let indication = document.getElementById("indications");
    let correction = document.getElementById("correction");
    
    // Récupération de l'entête
    const debutEntete = fetchedText.indexOf("{");
    const finEntete = fetchedText.indexOf("}");
    var entete = fetchedText.slice(debutEntete+1, finEntete);
    entete = entete.split(", ");
    
    numExercice.textContent = "Exercice " + entete[0];
    auteur.textContent = "Auteur : " + entete[1];
    date.textContent = " Le " + entete[2];

    // Récupération de vidéo s'il y en a
    const debutVideo = fetchedText.indexOf(String.raw`\video`);
    if (debutVideo != -1){ // S'il y a une vidéo
      let video = document.getElementById('h1');
      video.textContent = fetchedText.slice(debutVideo, debutVideo+100);
      var finVideo = video.indexOf("}");
      video.textContent = video.textContent.slice(7, finVideo);
    }

    // Récupération de l'énoncé
    const debutEnonce = fetchedText.indexOf(String.raw`\enonce`);
    const finEnonce = fetchedText.indexOf(String.raw`\finenonce`);
    enonce.textContent = fetchedText.slice(debutEnonce+7, finEnonce);
    
    // Récupération de l'indication s'il y en a
    const debutIndication = fetchedText.indexOf(String.raw`\indication`);
    if (debutIndication != -1){
      const finIndication = fetchedText.indexOf(String.raw`\finindication`);
      indication.textContent = fetchedText.slice(debutIndication+12, finIndication);
    }
    
    // Récupération de la correction s'il y en a
    const debutCorrection = fetchedText.indexOf(String.raw`\correction`);
    if (debutCorrection != -1){
      const finCorrection = fetchedText.indexOf(String.raw`\fincorrection`);
      correction.textContent = fetchedText.slice(debutCorrection+12, finCorrection-1);
    }

     // Remplacement des accents.
    auteur.textContent = replaceAccents(auteur.textContent);
    enonce.textContent = replaceAccents(enonce.textContent);
    indication.textContent = replaceAccents(indication.textContent);
    correction.textContent = replaceAccents(correction.textContent);
    correction.textContent = correction.textContent.replaceAll(String.raw`\qquad`, '&emsp;');
    
    // Chargement de la librairie Mathjax
    setTimeout(() => {
      MathJax.typesetPromise([enonce]) // Typeset the text element
        .catch(error => console.error('Failed to typeset math:', error));
    }, 100); // Adjust the delay as needed
    setTimeout(() => {
      MathJax.typesetPromise([indication]) // Typeset the text element
        .catch(error => console.error('Failed to typeset math:', error));
    }, 100); // Adjust the delay as needed
    setTimeout(() => {
      MathJax.typesetPromise([correction]) // Typeset the text element
        .catch(error => console.error('Failed to typeset math:', error));
    }, 100); // Adjust the delay as needed
  })
  .catch(error => {
    console.error('Failed to fetch text:', error);
  });
    </script>
  </body>
</html>